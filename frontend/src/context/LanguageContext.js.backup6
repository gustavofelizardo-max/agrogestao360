import React, { createContext, useContext, useState, useEffect } from 'react';

const LanguageContext = createContext();

export const useLanguage = () => {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useLanguage deve ser usado dentro de um LanguageProvider');
  }
  return context;
};

const translations = {
  pt: {
    // Menu
    'menu.dashboard': 'Dashboard',
    'menu.properties': 'Propriedades',
    'menu.cultures': 'Culturas',
    'menu.weather': 'Clima',
    'menu.alerts': 'Alertas',
    'menu.users': 'Usuários',
    'menu.settings': 'Configurações',

    // Auth
    'auth.login': 'Entrar',
    'auth.logout': 'Sair',
    'auth.logout_success': 'Logout realizado com sucesso!',
    'auth.logging_in': 'Entrando...',
    'auth.welcome': 'Sistema de Gestão Agrícola',
    'auth.email': 'Email',
    'auth.password': 'Senha',
    'auth.email_placeholder': 'seu@email.com',
    'auth.password_placeholder': '••••••••',
    'auth.use_test_credentials': 'Usar credenciais de teste',

    // User Types
    'user.types.producer': 'Produtor',
    'user.types.supplier': 'Fornecedor',
    'user.types.buyer': 'Comprador',

    // Dashboard
    'dashboard.welcome': 'Bem-vindo',
    'dashboard.total_properties': 'Total de Propriedades',
    'dashboard.cultivated_area': 'Área Cultivada',
    'dashboard.total_cultures': 'Culturas Cadastradas',
    'dashboard.active_alerts': 'Alertas Ativos',
    'dashboard.error.load': 'Erro ao carregar dados do dashboard',

    // Common
    'common.loading': 'Carregando...',
    'common.save': 'Salvar',
    'common.update': 'Atualizar',
    'common.cancel': 'Cancelar',
    'common.edit': 'Editar',
    'common.delete': 'Excluir',
    'common.yes': 'Sim',
    'common.no': 'Não',

    // Settings
    'settings.title': 'Configurações do Sistema',
    'settings.language': 'Idioma',
    'settings.notifications': 'Notificações',
    'settings.api': 'Configurações de API',

    // Cultures
    'cultures.title': 'Gestão de Culturas',
    'cultures.new': 'Nova Cultura',
    'cultures.manage': 'Gerenciar Culturas',
    'cultures.add': 'Adicionar Cultura',
    'cultures.edit': 'Editar Cultura',
    'cultures.form.name': 'Nome da Cultura',
    'cultures.form.category': 'Categoria',
    'cultures.form.season': 'Época de Plantio',
    'cultures.form.cycle': 'Ciclo (dias)',
    'cultures.form.description': 'Descrição',

    // Properties
    'properties.title': 'Gestão de Propriedades',
    'properties.new': 'Nova Propriedade',
    'properties.edit': 'Editar Propriedade',
    'properties.form.name': 'Nome da Propriedade',
    'properties.form.owner': 'Proprietário',
    'properties.form.cep': 'CEP',
    'properties.form.address': 'Endereço',
    'properties.form.number': 'Número',
    'properties.form.city': 'Cidade',
    'properties.form.neighborhood': 'Bairro',
    'properties.form.state': 'UF',
    'properties.form.total_area': 'Área Total (ha)',
    'properties.form.arable_area': 'Área Arável (ha)',
    'properties.form.legal_reserve': 'Reserva Legal (ha)',
    'properties.form.main_cultures': 'Culturas Principais',
    'properties.form.has_irrigation': 'Possui Irrigação',
    'properties.form.has_machinery': 'Possui Maquinário',
    'properties.form.has_storage': 'Possui Armazenamento',
    'properties.form.description': 'Descrição Adicional',
    'properties.search_cep': 'Buscar',

    // Weather
    'weather.title': 'Monitoramento Meteorológico',
    'weather.update': 'Atualizar',
    'weather.updating': 'Atualizando...',
    'weather.humidity': 'Umidade',
    'weather.wind': 'Vento',
    'weather.pressure': 'Pressão',
    'weather.visibility': 'Visibilidade',

    // Alerts
    'alerts.title': 'Alertas e Notificações',
    'alerts.new': 'Novo Alerta',

    // Users
    'users.title': 'Gerenciamento de Usuários',
    'users.new': 'Novo Usuário'
  },

  en: {
    // Menu
    'menu.dashboard': 'Dashboard',
    'menu.properties': 'Properties',
    'menu.cultures': 'Cultures',
    'menu.weather': 'Weather',
    'menu.alerts': 'Alerts',
    'menu.users': 'Users',
    'menu.settings': 'Settings',

    // Auth
    'auth.login': 'Login',
    'auth.logout': 'Logout',
    'auth.logout_success': 'Logout successful!',
    'auth.logging_in': 'Logging in...',
    'auth.welcome': 'Agricultural Management System',
    'auth.email': 'Email',
    'auth.password': 'Password',
    'auth.email_placeholder': 'your@email.com',
    'auth.password_placeholder': '••••••••',
    'auth.use_test_credentials': 'Use test credentials',

    // User Types
    'user.types.producer': 'Producer',
    'user.types.supplier': 'Supplier',
    'user.types.buyer': 'Buyer',

    // Dashboard
    'dashboard.welcome': 'Welcome',
    'dashboard.total_properties': 'Total Properties',
    'dashboard.cultivated_area': 'Cultivated Area',
    'dashboard.total_cultures': 'Registered Cultures',
    'dashboard.active_alerts': 'Active Alerts',
    'dashboard.error.load': 'Error loading dashboard data',

    // Common
    'common.loading': 'Loading...',
    'common.save': 'Save',
    'common.update': 'Update',
    'common.cancel': 'Cancel',
    'common.edit': 'Edit',
    'common.delete': 'Delete',
    'common.yes': 'Yes',
    'common.no': 'No',

    // Settings
    'settings.title': 'System Settings',
    'settings.language': 'Language',
    'settings.notifications': 'Notifications',
    'settings.api': 'API Settings',

    // Cultures
    'cultures.title': 'Culture Management',
    'cultures.new': 'New Culture',
    'cultures.manage': 'Manage Cultures',
    'cultures.add': 'Add Culture',
    'cultures.edit': 'Edit Culture',
    'cultures.form.name': 'Culture Name',
    'cultures.form.category': 'Category',
    'cultures.form.season': 'Planting Season',
    'cultures.form.cycle': 'Cycle (days)',
    'cultures.form.description': 'Description',

    // Properties
    'properties.title': 'Property Management',
    'properties.new': 'New Property',
    'properties.edit': 'Edit Property',
    'properties.form.name': 'Property Name',
    'properties.form.owner': 'Owner',
    'properties.form.cep': 'ZIP Code',
    'properties.form.address': 'Address',
    'properties.form.number': 'Number',
    'properties.form.city': 'City',
    'properties.form.neighborhood': 'Neighborhood',
    'properties.form.state': 'State',
    'properties.form.total_area': 'Total Area (ha)',
    'properties.form.arable_area': 'Arable Area (ha)',
    'properties.form.legal_reserve': 'Legal Reserve (ha)',
    'properties.form.main_cultures': 'Main Cultures',
    'properties.form.has_irrigation': 'Has Irrigation',
    'properties.form.has_machinery': 'Has Machinery',
    'properties.form.has_storage': 'Has Storage',
    'properties.form.description': 'Additional Description',
    'properties.search_cep': 'Search',

    // Weather
    'weather.title': 'Weather Monitoring',
    'weather.update': 'Update',
    'weather.updating': 'Updating...',
    'weather.humidity': 'Humidity',
    'weather.wind': 'Wind',
    'weather.pressure': 'Pressure',
    'weather.visibility': 'Visibility',

    // Alerts
    'alerts.title': 'Alerts and Notifications',
    'alerts.new': 'New Alert',

    // Users
    'users.title': 'User Management',
    'users.new': 'New User'
  },

  es: {
    // Menu
    'menu.dashboard': 'Panel',
    'menu.properties': 'Propiedades',
    'menu.cultures': 'Cultivos',
    'menu.weather': 'Clima',
    'menu.alerts': 'Alertas',
    'menu.users': 'Usuarios',
    'menu.settings': 'Configuración',

    // Auth
    'auth.login': 'Ingresar',
    'auth.logout': 'Salir',
    'auth.logout_success': '¡Logout exitoso!',
    'auth.logging_in': 'Ingresando...',
    'auth.welcome': 'Sistema de Gestión Agrícola',
    'auth.email': 'Email',
    'auth.password': 'Contraseña',
    'auth.email_placeholder': 'tu@email.com',
    'auth.password_placeholder': '••••••••',
    'auth.use_test_credentials': 'Usar credenciales de prueba',

    // User Types
    'user.types.producer': 'Productor',
    'user.types.supplier': 'Proveedor',
    'user.types.buyer': 'Comprador',

    // Dashboard
    'dashboard.welcome': 'Bienvenido',
    'dashboard.total_properties': 'Total de Propiedades',
    'dashboard.cultivated_area': 'Área Cultivada',
    'dashboard.total_cultures': 'Cultivos Registrados',
    'dashboard.active_alerts': 'Alertas Activas',
    'dashboard.error.load': 'Error al cargar datos del panel',

    // Common
    'common.loading': 'Cargando...',
    'common.save': 'Guardar',
    'common.update': 'Actualizar',
    'common.cancel': 'Cancelar',
    'common.edit': 'Editar',
    'common.delete': 'Eliminar',
    'common.yes': 'Sí',
    'common.no': 'No',

    // Settings
    'settings.title': 'Configuración del Sistema',
    'settings.language': 'Idioma',
    'settings.notifications': 'Notificaciones',
    'settings.api': 'Configuración de API',

    // Cultures
    'cultures.title': 'Gestión de Cultivos',
    'cultures.new': 'Nuevo Cultivo',
    'cultures.manage': 'Gestionar Cultivos',
    'cultures.add': 'Agregar Cultivo',
    'cultures.edit': 'Editar Cultivo',
    'cultures.form.name': 'Nombre del Cultivo',
    'cultures.form.category': 'Categoría',
    'cultures.form.season': 'Época de Siembra',
    'cultures.form.cycle': 'Ciclo (días)',
    'cultures.form.description': 'Descripción',

    // Properties
    'properties.title': 'Gestión de Propiedades',
    'properties.new': 'Nueva Propiedad',
    'properties.edit': 'Editar Propiedad',
    'properties.form.name': 'Nombre de la Propiedad',
    'properties.form.owner': 'Propietario',
    'properties.form.cep': 'Código Postal',
    'properties.form.address': 'Dirección',
    'properties.form.number': 'Número',
    'properties.form.city': 'Ciudad',
    'properties.form.neighborhood': 'Barrio',
    'properties.form.state': 'Estado',
    'properties.form.total_area': 'Área Total (ha)',
    'properties.form.arable_area': 'Área Cultivable (ha)',
    'properties.form.legal_reserve': 'Reserva Legal (ha)',
    'properties.form.main_cultures': 'Cultivos Principales',
    'properties.form.has_irrigation': 'Tiene Riego',
    'properties.form.has_machinery': 'Tiene Maquinaria',
    'properties.form.has_storage': 'Tiene Almacenamiento',
    'properties.form.description': 'Descripción Adicional',
    'properties.search_cep': 'Buscar',

    // Weather
    'weather.title': 'Monitoreo Meteorológico',
    'weather.update': 'Actualizar',
    'weather.updating': 'Actualizando...',
    'weather.humidity': 'Humedad',
    'weather.wind': 'Viento',
    'weather.pressure': 'Presión',
    'weather.visibility': 'Visibilidad',

    // Alerts
    'alerts.title': 'Alertas y Notificaciones',
    'alerts.new': 'Nueva Alerta',

    // Users
    'users.title': 'Gestión de Usuarios',
    'users.new': 'Nuevo Usuario'
  }
};

const getLanguageFlag = (lang) => {
  switch (lang) {
    case 'pt': return '🇧🇷';
    case 'en': return '🇺🇸';
    case 'es': return '🇪🇸';
    default: return '🇧🇷';
  }
};

const getLanguageLabel = (lang) => {
  switch (lang) {
    case 'pt': return 'Português';
    case 'en': return 'English';
    case 'es': return 'Español';
    default: return 'Português';
  }
};

export const LanguageProvider = ({ children }) => {
  const [language, setLanguage] = useState(() => {
    return localStorage.getItem('language') || 'pt';
  });

  useEffect(() => {
    localStorage.setItem('language', language);
  }, [language]);

  const t = (key, fallback = null) => {
    const translation = translations[language]?.[key];
    if (translation) {
      return translation;
    }
    
    const ptTranslation = translations['pt']?.[key];
    if (ptTranslation) {
      return ptTranslation;
    }
    
    if (fallback) {
      return fallback;
    }
    
    // Fallbacks específicos para evitar chaves sendo mostradas
    switch(key) {
      case 'menu.dashboard': return 'Dashboard';
      case 'menu.properties': return 'Propriedades';
      case 'menu.cultures': return 'Culturas';
      case 'menu.weather': return 'Clima';
      case 'menu.alerts': return 'Alertas';
      case 'menu.users': return 'Usuários';
      case 'menu.settings': return 'Configurações';
      case 'auth.logout': return 'Sair';
      case 'user.types.producer': return 'Produtor';
      case 'dashboard.welcome': return 'Bem-vindo';
      case 'dashboard.total_properties': return 'Total de Propriedades';
      case 'dashboard.cultivated_area': return 'Área Cultivada';
      case 'dashboard.total_cultures': return 'Culturas Cadastradas';
      case 'dashboard.active_alerts': return 'Alertas Ativos';
      case 'common.loading': return 'Carregando...';
      case 'settings.title': return 'Configurações do Sistema';
      case 'settings.language': return 'Idioma';
      case 'settings.notifications': return 'Notificações';
      case 'settings.api': return 'Configurações de API';
      case 'cultures.manage': return 'Gerenciar Culturas';
      case 'properties.search_cep': return 'Buscar';
      default: return key;
    }
  };

  const cycleLanguage = () => {
    const languages = ['pt', 'en', 'es'];
    const currentIndex = languages.indexOf(language);
    const nextIndex = (currentIndex + 1) % languages.length;
    setLanguage(languages[nextIndex]);
  };

  const changeLanguage = (lang) => {
    if (translations[lang]) {
      setLanguage(lang);
    }
  };

  const value = {
    language,
    setLanguage: changeLanguage,
    cycleLanguage,
    t,
    getLanguageFlag,
    getLanguageLabel,
    availableLanguages: Object.keys(translations)
  };

  return (
    <LanguageContext.Provider value={value}>
      {children}
    </LanguageContext.Provider>
  );
};

export default LanguageContext;
